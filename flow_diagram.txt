flowchart TD
  subgraph P[Process one page]
    direction TB
    E2[Initial extraction using extractor agent]

    E2 --> F{Check If processing 
    Form fields or Tables?}

    %% Form fields branch
    F -->|Form_fields| FF1[Process a batch of 10 Form fields at a time]
    FF1 --> FF2[Judge validate form fields using 
    schema + extrated form fields + full text + image]
    FF2 --> FF3{Issues?}
    FF3 -->|Yes| FF4[Extractor_with_feedback correct form fields as per feedback given by Judge]
    FF4 --> FF2
    FF3 -->|No| FF5[Update Form_fields]

    %% Tables branch
    F -->|Tables| T5[Get & Filter OCR coordinates of concerned table from AzureDocIntelligence]
    T5 --> T6[Calculate what are all the empty cells in concerned table grid]
    T6 --> T7[Judge: validates table using 
    schema + full text + extracted table + empty cell info + image ]
    T7 --> T8{Issues?}
    T8 -->|Yes| T9[Extractor_with_feedback correct table as per feedback given by the Judge]
    T9 --> T7
    T8 -->|No| T10[Update Tables]

    FF5 --> E5[Finally save into corrected_extraction.json]
    T10 --> E5
    E5 --> E6[Stop]
  end
